<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments.html :: head"></head>
<body class="c-app">
<div th:replace="fragments.html::leftMenu"></div>
<div class="c-wrapper c-fixed-components">
    <header th:replace="fragments.html::header ('결제 화면', '결제 화면')"></header>
    <div class="c-body">
        <main class="c-main">
            <div class="container-fluid">
                <div class="fade-in">
                    <div class="row">
                        <div class="col-lg-8 col-md-7 col-sm-12">
                            <div th:if="${not #strings.isEmpty(message)}">
                                <div th:replace="fragments.html::alert(${alertType}, ${message})"></div>
                            </div>
                            <div class="card">
                                <div class="card-header">결제 창</div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label for="item-select">상품명 또는 바코드를 입력해주세요.</label>
                                                <select class="form-control js-example-templating" id="item-select">
                                                    <option></option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <table class="table table-responsive-sm table-striped table-hover">
                                                    <thead>
                                                    <tr>
                                                        <th>상품명</th>
                                                        <th>스케쥴</th>
                                                        <th>단가</th>
                                                        <th>개수</th>
                                                        <th>합계</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="item-list">
                                                    <tr th:each="cartItem : ${cart.items}">
                                                        <td th:text="${cartItem.getItemName()}"></td>
                                                        <td th:text="${cartItem.getScheduleName()}"></td>
                                                        <td th:text="${#numbers.formatInteger(cartItem.getSalePrice(), 3, 'COMMA')}"></td>
                                                        <td th:text="${cartItem.getCount()}"></td>
                                                        <td th:text="${#numbers.formatInteger(cartItem.getCount() * cartItem.getSalePrice(), 3, 'COMMA')}"></td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-5 col-sm-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">결제</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <span class="h2">합계 </span>
                                                        <span class="h1" id="total-price" th:text="${#numbers.formatInteger(cart.getTotalPrice(), 3, 'COMMA')}">
                                                        </span>
                                                        <span class="h2"> 원</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <form th:action="@{/sale}" th:method="post" id="sale-form">
                                                        <input type="hidden" name="saleType" id="sale-form-saleType">
                                                        <input type="hidden" name="paymentType" id="sale-form-paymentType">
                                                    </form>
                                                    <div class="btn-group btn-group-lg mb-3" role="group" aria-label="Large button group">
                                                        <button class="btn btn-primary" type="button" id="pay-cash-button">현금 결제</button>
                                                        <button class="btn btn-secondary" type="button" id="pay-card-button">카드 결제</button>
                                                        <button class="btn btn-light" type="button" id="reset-button">초기화</button>
                                                        <button class="btn btn-dark" type="button" id="cancel-button">결제 취소</button>
                                                        <button class="btn btn-dark" type="button" data-toggle="modal" data-target="#coupon-modal">테스트</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">호텔 및 유치원</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <div id="hotel-grid"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">미용</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <div id="beauty-grid"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">최근 결제 내역</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <div id="history-grid"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer th:replace="fragments.html::footer"></footer>
    </div>
</div>

<div th:replace="sale/beauty-modal.html::beauty-modal"></div>
<div th:replace="sale/hotel-modal.html::hotel-modal(${hotelItems})"></div>
<div th:replace="sale/kindergarten-modal.html::kindergarten-modal(${kindergartenItems})"></div>
<div th:if="${couponIssuableCustomers != null} AND ${not #arrays.isEmpty(couponIssuableCustomers)}">
    <div th:replace="sale/coupon-modal.html::coupon-modal(${couponIssuableCustomers}, ${couponTypes})"></div>
</div>

<link rel="stylesheet" href="/node_modules/select2/dist/css/select2.min.css"/>
<link rel="stylesheet" href="/node_modules/tui-grid/dist/tui-grid.css">
<script th:replace="fragments.html::script"></script>
<script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>
<script src="/node_modules/select2/dist/js/select2.min.js"></script>
<script src="/node_modules/tui-grid/dist/tui-grid.js"></script>
<script src="/node_modules/moment/min/moment-with-locales.min.js"></script>
<script src="/js/sale/main.js"></script>
<script th:inline="javascript" type="application/javascript">
    $(function(){
        let hotelGridData = [];
        let beautyGridData = [];
        /*<![CDATA[*/

        /*[# th:each="row : ${schedules}"]*/
        var scheduleType = /*[[${row.getScheduleType()}]]*/;
        if (scheduleType == "HOTEL" || scheduleType == "KINDERGARTEN")
        {
            hotelGridData.push({
                id : /*[[${row.getId()}]]*/,
                scheduleType : /*[[${row.getScheduleType()}]]*/,
                scheduleTypeName : /*[[${row.getScheduleTypeName()}]]*/,
                customerName : /*[[${row.getCustomerName()}]]*/,
                customerTypeName : /*[[${row.getCustomerTypeName()}]]*/,
                customerTelNo : /*[[${row.getCustomerTelNo()}]]*/,
                startDate : /*[[${row.getStartDate()}]]*/,
                endDate : /*[[${row.getEndDate()}]]*/
            });
        }
        else if (scheduleType == "BEAUTY")
        {
            beautyGridData.push({
                id : /*[[${row.getId()}]]*/,
                customerName : /*[[${row.getCustomerName()}]]*/,
                customerTypeName : /*[[${row.getCustomerTypeName()}]]*/,
                customerTelNo : /*[[${row.getCustomerTelNo()}]]*/
            });
        }
        /*[/]*/

        initComponents();
        /*]]>*/
    });
</script>
</body>
</html>